:root {
  --bg-0: #05050b;
  --bg-1: #0b0d17;
  --line: #3a3e4b;
  --text: #f3f5fb;
  --muted: #9aa3b7;
  --accent: #8d30d8;
}

* { box-sizing: border-box; }

body {
  margin: 0;
  min-height: 100vh;
  font-family: "Segoe UI", "Tahoma", sans-serif;
  color: var(--text);
  background:
    radial-gradient(circle at 18% 20%, #171236 0%, transparent 36%),
    radial-gradient(circle at 32% 80%, #121029 0%, transparent 40%),
    linear-gradient(130deg, var(--bg-0), var(--bg-1) 50%, #09090f 100%);
}

.layout {
  min-height: 100vh;
  display: grid;
  grid-template-columns: 1fr minmax(430px, 40vw);
}

.left-stage {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 36px;
}

.ambient-glow {
  position: absolute;
  width: min(70vw, 860px);
  aspect-ratio: 1.6;
  border-radius: 40px;
  background: radial-gradient(circle, rgba(86, 55, 183, 0.22), rgba(14, 16, 26, 0) 68%);
  filter: blur(22px);
  pointer-events: none;
}

.device-shell {
  position: relative;
  width: min(760px, 92vw);
  aspect-ratio: 1.52;
  border-radius: 54px;
  padding: 44px 102px 122px;
  background:
    linear-gradient(160deg, rgba(70, 74, 84, 0.9), rgba(34, 36, 42, 0.96) 52%, rgba(53, 55, 64, 0.94)),
    radial-gradient(circle at 28% 28%, rgba(255, 255, 255, 0.1), transparent 35%);
  border: 1px solid rgba(255, 255, 255, 0.08);
  box-shadow:
    0 30px 60px rgba(0, 0, 0, 0.5),
    inset 0 1px 0 rgba(255, 255, 255, 0.15),
    inset 0 -18px 40px rgba(0, 0, 0, 0.34);
}

.knob {
  position: absolute;
  width: clamp(52px, 4.4vw, 70px);
  aspect-ratio: 1;
  border-radius: 999px;
  background:
    radial-gradient(circle at 30% 28%, #4f5666, #282b34 45%, #16191f 75%),
    linear-gradient(180deg, rgba(255, 255, 255, 0.08), rgba(0, 0, 0, 0.22));
  border: 1px solid rgba(255, 255, 255, 0.08);
  box-shadow:
    inset 0 2px 8px rgba(255, 255, 255, 0.1),
    inset 0 -6px 12px rgba(0, 0, 0, 0.42),
    0 8px 14px rgba(0, 0, 0, 0.35);
}

.knob-l1 { left: 28px; top: 78px; }
.knob-l2 { left: 28px; top: 192px; }
.knob-l3 { left: 28px; top: 306px; }
.knob-r1 { right: 28px; top: 78px; }
.knob-r2 { right: 28px; top: 192px; }
.knob-r3 { right: 28px; top: 306px; }

.device-screen-frame {
  display: grid;
  grid-template-columns: 42px 1fr 42px;
  gap: 14px;
  padding: 12px;
  border-radius: 18px;
  background: #15171d;
  border: 1px solid rgba(255, 255, 255, 0.06);
}

.side-screen {
  border-radius: 8px;
  background: #020204;
  border: 1px solid rgba(255, 255, 255, 0.06);
}

.center-grid {
  display: grid;
  grid-template-columns: repeat(4, minmax(56px, 1fr));
  gap: 14px;
}

.key-slot {
  min-height: 0;
  aspect-ratio: 1 / 1;
  border-radius: 10px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  color: #dce2f5;
  display: grid;
  grid-template-rows: auto 1fr auto;
  gap: 4px;
  padding: 6px;
  cursor: pointer;
  position: relative;
  overflow: hidden;
  transition: transform 120ms ease, border-color 120ms ease, box-shadow 120ms ease;
}

.key-slot.empty {
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 30px;
  color: #6f7690;
}

.key-slot.selected {
  border-color: #7d68ff;
  box-shadow: 0 0 0 2px rgba(125, 104, 255, 0.35);
}

.key-slot.drag-over {
  border-color: #4ecf9b;
  box-shadow: 0 0 0 2px rgba(78, 207, 155, 0.35);
  transform: translateY(-1px);
}

.slot-type {
  font-size: 9px;
  letter-spacing: 0.06em;
  color: #a8b0c7;
  text-transform: uppercase;
}

.slot-label {
  font-size: 11px;
  color: #f3f5fb;
  align-self: center;
  justify-self: center;
  text-align: center;
  width: 100%;
  max-width: 100%;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.slot-meta {
  display: grid;
  grid-template-columns: 1fr auto;
  align-items: center;
  gap: 4px;
  font-size: 9px;
  color: #a3abc2;
  min-width: 0;
}

.slot-meta > span:first-child {
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.slot-badge {
  border: 1px solid rgba(255, 255, 255, 0.18);
  border-radius: 999px;
  padding: 1px 5px;
  flex-shrink: 0;
}

.slot-unassign {
  position: absolute;
  right: 4px;
  top: 4px;
  width: 18px;
  min-width: 18px;
  height: 18px;
  padding: 0;
  border-radius: 999px;
  border: 1px solid rgba(255, 255, 255, 0.28);
  background: rgba(8, 10, 16, 0.7);
  color: #f3f5fb;
  font-size: 12px;
  line-height: 1;
}

.profile-row {
  position: absolute;
  left: 50%;
  bottom: 28px;
  transform: translateX(-50%);
  display: grid;
  grid-template-columns: repeat(8, minmax(42px, 1fr));
  gap: 12px;
  width: calc(100% - 120px);
}

.profile-item {
  position: relative;
}

.profile-btn {
  --profile-light: #3b4251;
  --profile-dark: #191c24;
  --profile-ring: #7ec7a2;
  width: 100%;
  border: 1px solid rgba(255, 255, 255, 0.08);
  border-radius: 999px;
  min-height: 50px;
  background: radial-gradient(circle at 28% 28%, var(--profile-light), var(--profile-dark) 64%);
  color: #f5f7ff;
  font-weight: 600;
  cursor: pointer;
  transition: transform 120ms ease, box-shadow 120ms ease, border-color 120ms ease, filter 120ms ease;
}

.profile-btn:hover {
  transform: translateY(-1px);
  filter: brightness(1.08);
}

.profile-btn.selected {
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--profile-ring) 40%, transparent);
}

.profile-btn.active {
  border-color: color-mix(in srgb, var(--profile-ring) 82%, white 18%);
  box-shadow:
    inset 0 0 0 1px color-mix(in srgb, var(--profile-ring) 38%, transparent),
    0 0 0 2px color-mix(in srgb, var(--profile-ring) 28%, transparent);
  filter: saturate(1.2) brightness(1.1);
}

.profile-led-input {
  position: absolute;
  right: 4px;
  bottom: 4px;
  width: 18px;
  height: 18px;
  padding: 0;
  border: 1px solid rgba(255, 255, 255, 0.32);
  border-radius: 999px;
  background: transparent;
  cursor: pointer;
}

.profile-led-input::-webkit-color-swatch-wrapper {
  padding: 0;
  border-radius: 999px;
}

.profile-led-input::-webkit-color-swatch {
  border: none;
  border-radius: 999px;
}

.profile-led-input::-moz-color-swatch {
  border: none;
  border-radius: 999px;
}

.right-panel {
  background: linear-gradient(180deg, #23252c, #1f2027);
  border-left: 1px solid rgba(255, 255, 255, 0.08);
  display: grid;
  grid-template-rows: auto 1fr;
}

.panel-topbar {
  display: grid;
  grid-template-columns: 1fr auto auto auto;
  gap: 8px;
  padding: 12px;
  border-bottom: 1px solid var(--line);
  background: #1b1c23;
}

.search-wrap { position: relative; }

.search-wrap input,
.editor input,
.editor select,
.modal-card input,
button {
  width: 100%;
  border: 1px solid #323543;
  background: #2a2c35;
  color: var(--text);
  border-radius: 6px;
  padding: 10px 12px;
}

button { cursor: pointer; font-weight: 600; }
.top-btn { min-width: 74px; }
button.ghost { background: #21242d; }
button.danger {
  background: #4a1f24;
  border-color: #74333b;
}

.menu-wrap {
  position: relative;
}

.menu-panel {
  position: absolute;
  right: 0;
  top: calc(100% + 6px);
  width: 180px;
  border: 1px solid #3f4351;
  border-radius: 8px;
  background: #1d2029;
  padding: 6px;
  display: grid;
  gap: 6px;
  z-index: 15;
}

.menu-panel button {
  text-align: left;
}

.search-icon {
  position: absolute;
  right: 10px;
  top: 50%;
  transform: translateY(-50%);
  color: #cfd3dd;
  font-size: 14px;
}

.panel-main {
  min-height: 0;
  padding: 14px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  overflow: auto;
}

.panel-statusline { display: flex; gap: 8px; }

.status-badge {
  display: inline-flex;
  align-items: center;
  min-height: 22px;
  padding: 3px 8px;
  border-radius: 999px;
  border: 1px solid rgba(255, 255, 255, 0.12);
  font-size: 11px;
  background: #2d303a;
}

.status-badge.online {
  color: #d2ffea;
  border-color: rgba(30, 190, 116, 0.58);
  background: rgba(26, 97, 63, 0.28);
}

.status-badge.offline {
  color: #ffd2d2;
  border-color: rgba(204, 79, 79, 0.6);
  background: rgba(120, 30, 30, 0.25);
}

h2 { margin: 0; font-size: 42px; line-height: 1.05; }
.event-line,
.hint { color: var(--muted); font-size: 12px; }

.message {
  padding: 9px 10px;
  border-radius: 8px;
  border: 1px solid #3f4454;
  background: #242732;
  font-size: 12px;
}

.message.error {
  border-color: #914141;
  background: #382224;
  color: #ffd7d7;
}

.hidden { display: none !important; }

.widget-library,
.editor {
  border: 1px solid #3f4351;
  border-radius: 10px;
  background: #242732;
  padding: 10px;
}

.widget-library-head,
.editor-head {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 8px;
}

.widget-library-head h3,
.editor-head h3 { margin: 0; }

.widget-library p { margin: 4px 0 10px; color: var(--muted); font-size: 12px; }

.plus-btn {
  width: 34px;
  min-width: 34px;
  height: 34px;
  padding: 0;
  font-size: 24px;
  line-height: 1;
}

.widget-list {
  display: grid;
  gap: 8px;
  max-height: 210px;
  overflow: auto;
}

.widget-card {
  border: 1px solid #3f4351;
  border-radius: 8px;
  background: #161922;
  color: #eef2ff;
  padding: 8px;
  display: grid;
  grid-template-columns: 22px 1fr auto;
  gap: 8px;
  align-items: center;
  cursor: grab;
  user-select: none;
}

.widget-card.selected {
  border-color: #7d68ff;
  box-shadow: 0 0 0 1px rgba(125, 104, 255, 0.35);
}

.widget-dot {
  width: 16px;
  height: 16px;
  border-radius: 999px;
  border: 1px solid rgba(255, 255, 255, 0.32);
}

.widget-name { font-size: 12px; }
.widget-template {
  font-size: 10px;
  color: #d3d8ea;
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 999px;
  padding: 1px 6px;
}

.editor { display: grid; gap: 8px; }
.editor {
  align-content: start;
  grid-auto-rows: min-content;
}

.multi-steps {
  display: grid;
  gap: 6px;
}

.multi-step-row {
  display: grid;
  grid-template-columns: auto 1fr auto;
  gap: 8px;
  align-items: center;
  border: 1px solid #3f4351;
  border-radius: 8px;
  background: #161922;
  padding: 6px 8px;
}

.multi-step-type {
  font-size: 10px;
  color: #d3d8ea;
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 999px;
  padding: 1px 6px;
}

.multi-step-name {
  font-size: 12px;
  color: #eef2ff;
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.multi-step-remove {
  width: auto;
  min-width: 30px;
  padding: 4px 8px;
  font-size: 12px;
}

#addMultiActionStepBtn {
  width: auto;
  min-width: 90px;
}
.row { display: flex; gap: 8px; align-items: end; }
.field { display: grid; gap: 4px; }
.field.grow { flex: 1; }
.field label { font-size: 12px; color: var(--muted); }

.color-field input[type='color'] {
  width: 56px;
  padding: 0;
  height: 38px;
}

.test-btn {
  width: auto;
  min-width: 90px;
  background: #1b7d4a;
}

.modal {
  position: fixed;
  inset: 0;
  background: rgba(4, 5, 11, 0.75);
  display: grid;
  place-items: center;
  padding: 16px;
  z-index: 20;
}

.modal.hidden { display: none; }

.modal-card {
  width: min(460px, 95vw);
  border: 1px solid #3f4351;
  border-radius: 12px;
  background: #242732;
  padding: 14px;
  display: grid;
  gap: 12px;
}

.modal-card h3 { margin: 0; }

.template-list {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 8px;
}

.template-btn {
  border: 1px solid #3f4351;
  background: #161922;
  color: #eef2ff;
  border-radius: 8px;
  padding: 10px;
  font-size: 12px;
}

.template-btn.selected {
  border-color: #7d68ff;
  box-shadow: 0 0 0 1px rgba(125, 104, 255, 0.35);
}

.modal-actions {
  display: flex;
  justify-content: end;
  gap: 8px;
}

.context-menu {
  position: fixed;
  min-width: 140px;
  border: 1px solid #3f4351;
  border-radius: 8px;
  background: #1d2029;
  padding: 6px;
  display: grid;
  gap: 6px;
  z-index: 30;
  box-shadow: 0 10px 24px rgba(0, 0, 0, 0.45);
}

.context-menu button {
  text-align: left;
}

.context-menu.hidden {
  display: none;
}

button:disabled {
  opacity: 0.45;
  cursor: not-allowed;
}

@media (max-width: 1200px) {
  .layout { grid-template-columns: 1fr; }
  .right-panel { border-left: 0; border-top: 1px solid rgba(255, 255, 255, 0.08); }
}

@media (max-width: 740px) {
  .left-stage { padding: 20px 10px 28px; }
  .device-shell { border-radius: 34px; padding: 34px 74px 106px; }
  .profile-row { width: calc(100% - 72px); gap: 8px; }
  .profile-btn { min-height: 42px; font-size: 12px; }
  h2 { font-size: 30px; }
  .panel-topbar { grid-template-columns: 1fr 72px 72px 72px; }
  .template-list { grid-template-columns: 1fr; }
}
